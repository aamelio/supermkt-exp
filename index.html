<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Supermarket Experience</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>

<style>
  body {
    margin: 0;
    background: #eee;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI";
  }
  #defaultCanvas0 { display: block; margin: 0 auto; }
</style>
</head>

<body>
<script>
/* ---------------------------------------------------------
   IMAGE CONFIGURATION (You may replace URLs anytime)
   --------------------------------------------------------- */

let IMG = {};

function preload() {
  IMG.supermarket = loadImage("https://upload.wikimedia.org/wikipedia/commons/1/14/Interior_of_a_Supermarket_in_Brunei_2.jpg");
  IMG.aisle = loadImage("https://upload.wikimedia.org/wikipedia/commons/c/c4/Supermarket_aisle.jpg");
  IMG.cereal = loadImage("https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Cornflakes_bowl.jpg/640px-Cornflakes_bowl.jpg");
  IMG.snacks = loadImage("https://upload.wikimedia.org/wikipedia/commons/3/3f/Chips.jpg");
  IMG.drinks = loadImage("https://upload.wikimedia.org/wikipedia/commons/1/18/Soft_drinks.jpg");
  IMG.cashier = loadImage("https://upload.wikimedia.org/wikipedia/commons/5/5f/Cashier_supermarket.jpg");
}

/* ---------------------------------------------------------
   STATE MANAGEMENT
   --------------------------------------------------------- */

let state = "overview"; 
let selectedProduct = null;
let pinInput = "";
const correctPin = "1289";

let aisleButtons = [];
let backButton;
let keypadButtons = [];
let clearBtn, enterBtn;

/* ---------------------------------------------------------
   SETUP
   --------------------------------------------------------- */

function setup() {
  createCanvas(900, 600);
  setupButtons();
}

function setupButtons() {
  aisleButtons = [
    { name: "Aisle 1", x: 120, y: 350, w: 150, h: 60, img: IMG.snacks, code: "snacks" },
    { name: "Aisle 2", x: 375, y: 350, w: 150, h: 60, img: IMG.aisle, code: "cereal" },
    { name: "Aisle 3", x: 630, y: 350, w: 150, h: 60, img: IMG.drinks, code: "drinks" }
  ];

  backButton = { x: 40, y: 530, w: 130, h: 40 };

  // Keypad
  let labels = ["1","2","3", "4","5","6", "7","8","9", "0"];
  let index = 0;
  let startX = 320, startY = 240;
  let bw = 80, bh = 60, gap = 15;

  keypadButtons = [];
  for (let r = 0; r < 4; r++) {
    for (let c = 0; c < 3; c++) {
      if (r === 3 && c > 0) break;
      keypadButtons.push({
        label: labels[index++],
        x: startX + c * (bw + gap),
        y: startY + r * (bh + gap),
        w: bw, h: bh
      });
    }
  }

  clearBtn = { label: "Clear", x: 320, y: startY + 4*(bh+gap), w: bw, h: bh };
  enterBtn = { label: "Enter", x: 320 + bw + gap, y: clearBtn.y, w: bw*2 + gap, h: bh };
}

/* ---------------------------------------------------------
   MAIN DRAW LOOP
   --------------------------------------------------------- */

function draw() {
  background(240);

  drawHeader();

  if (state === "overview")      drawOverview();
  if (state === "aisle")         drawAisle();
  if (state === "cashier")       drawCashier();
  if (state === "pin")           drawPinScreen();
  if (state === "success")       drawSuccess();
}

function drawHeader() {
  fill(30);
  rect(0,0,width,70);
  fill(255);
  textAlign(LEFT, CENTER);
  textSize(22);
  text("Supermarket Experience", 24, 35);
}

/* ---------------------------------------------------------
   SCREEN 1 — OVERVIEW
   --------------------------------------------------------- */

function drawOverview() {
  image(IMG.supermarket, 0, 70, width, 320);

  fill(50);
  textSize(18);
  text("Go to Aisle 2 and select the Cereal Box.", 24, 420);

  textAlign(CENTER, CENTER);
  textSize(16);
  fill(0);

  aisleButtons.forEach(btn => {
    fill(255);
    rect(btn.x, btn.y, btn.w, btn.h, 12);
    fill(30);
    text(btn.name, btn.x + btn.w/2, btn.y + btn.h/2);
  });
}

/* ---------------------------------------------------------
   SCREEN 2 — AISLE VIEW
   --------------------------------------------------------- */

function drawAisle() {
  image(IMG.aisle, 0, 70, width, 380);
  drawBackButton();

  fill(30);
  textSize(18);
  text("Click the Cereal Box in Aisle 2.", 24, 460);

  // Product images
  let px = 350, py = 200, pw = 200, ph = 200;
  image(IMG.cereal, px, py, pw, ph);

  fill(255);
  textAlign(CENTER, TOP);
  text("Cereal Box", px + pw/2, py + ph + 5);
}

/* ---------------------------------------------------------
   SCREEN 3 — CASHIER
   --------------------------------------------------------- */

function drawCashier() {
  image(IMG.cashier, 0, 70, width, 380);
  drawBackButton();

  fill(30);
  textSize(18);
  text("Click the cashier to pay.", 24, 480);
}

/* ---------------------------------------------------------
   SCREEN 4 — PIN ENTRY
   --------------------------------------------------------- */

function drawPinScreen() {
  fill(240);
  rect(260, 130, 380, 60, 10);

  fill(50);
  textSize(18);
  textAlign(LEFT, CENTER);
  text("Enter PIN:", 280, 160);

  let masked = "•".repeat(pinInput.length);
  textAlign(RIGHT, CENTER);
  text(masked, 620, 160);

  // Keypad
  textSize(18);
  textAlign(CENTER, CENTER);

  keypadButtons.forEach(btn => {
    fill(isHover(btn) ? 225 : 250);
    rect(btn.x, btn.y, btn.w, btn.h, 10);
    fill(40);
    text(btn.label, btn.x + btn.w/2, btn.y + btn.h/2);
  });

  fill(isHover(clearBtn)?225:250);
  rect(clearBtn.x, clearBtn.y, clearBtn.w, clearBtn.h, 10);
  fill(40);
  text("Clear", clearBtn.x + clearBtn.w/2, clearBtn.y + clearBtn.h/2);

  fill(isHover(enterBtn)?220:245);
  rect(enterBtn.x, enterBtn.y, enterBtn.w, enterBtn.h, 10);
  fill(40);
  text("Enter", enterBtn.x + enterBtn.w/2, enterBtn.y + enterBtn.h/2);
}

/* ---------------------------------------------------------
   SCREEN 5 — SUCCESS
   --------------------------------------------------------- */

function drawSuccess() {
  fill(255);
  rect(180, 160, width-360, 260, 20);

  fill(40, 130, 80);
  textSize(28);
  textAlign(CENTER, CENTER);
  text("Payment Accepted", width/2, 220);

  fill(60);
  textSize(18);
  text("You completed the supermarket task.\nClick 'Next' to continue.", width/2, 300);
}

/* ---------------------------------------------------------
   HELPERS
   --------------------------------------------------------- */

function drawBackButton() {
  fill(isHover(backButton)?210:230);
  rect(backButton.x, backButton.y, backButton.w, backButton.h, 10);
  fill(30);
  textAlign(CENTER, CENTER);
  textSize(14);
  text("Back", backButton.x + backButton.w/2, backButton.y + backButton.h/2);
}

function isHover(r) {
  return mouseX >= r.x && mouseX <= r.x+r.w &&
         mouseY >= r.y && mouseY <= r.y+r.h;
}

function mousePressed() {
  /* Overview */
  if (state === "overview") {
    aisleButtons.forEach(btn => {
      if (isHover(btn)) {
        if (btn.code === "cereal") state = "aisle";
      }
    });
  }

  /* Aisle */
  else if (state === "aisle") {
    if (isHover(backButton)) state = "overview";
    else {
      // Check cereal click
      let px = 350, py = 200, pw = 200, ph = 200;
      if (mouseX >= px && mouseX <= px+pw &&
          mouseY >= py && mouseY <= py+ph) {
        selectedProduct = "cereal";
        state = "cashier";
      }
    }
  }

  /* Cashier */
  else if (state === "cashier") {
    if (isHover(backButton)) state = "aisle";
    else {
      // Anywhere near center triggers cashier
      state = "pin";
    }
  }

  /* PIN Entry */
  else if (state === "pin") {
    keypadButtons.forEach(btn => {
      if (isHover(btn)) {
        if (pinInput.length < 6) pinInput += btn.label;
      }
    });

    if (isHover(clearBtn)) pinInput = "";

    if (isHover(enterBtn)) {
      if (pinInput === correctPin) state = "success";
      else pinInput = ""; // reset on wrong
    }
  }
}
</script>

</body>
</html>
