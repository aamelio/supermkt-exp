<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Supermarket Experience</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.0/lib/p5.min.js"></script>

  <style>
    body {
      margin: 0;
      background: #eeeeee;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    }
    #defaultCanvas0 {
      display: block;
      margin: 0 auto;
    }
  </style>
</head>
<body>

<script>

// --------------------------------------------------
// IMAGE PRELOAD (all images stored locally)
// --------------------------------------------------

let IMG = {};

function preload() {
  IMG.supermarket = loadImage("bg_supermarket.png");
  IMG.aisle2      = loadImage("aisle2.png");
  IMG.cereal      = loadImage("product_cereal.png");
  IMG.cashier     = loadImage("cashier.png");
}

// --------------------------------------------------
// STATE MACHINE
// overview → aisle → cashier → pin → success
// --------------------------------------------------

let state = "overview";
const PIN = "1289";
let pinInput = "";

// Clickable regions
let aisleButtons = [];
let backButton;
let cerealBoxRect;
let cashierRect;
let keypadButtons = [];
let clearBtn, enterBtn;


// --------------------------------------------------
// SETUP
// --------------------------------------------------

function setup() {
  createCanvas(900, 600);
  textFont("system-ui");

  aisleButtons = [
    { id: 1, label: "Aisle 1", x: 120, y: 460, w: 160, h: 60 },
    { id: 2, label: "Aisle 2", x: 370, y: 460, w: 160, h: 60 }, // Target aisle
    { id: 3, label: "Aisle 3", x: 620, y: 460, w: 160, h: 60 }
  ];

  backButton = { x: 40, y: 530, w: 130, h: 40 };

  cerealBoxRect = { x: 350, y: 240, w: 200, h: 220 };
  cashierRect   = { x: 280, y: 210, w: 340, h: 240 };

  setupKeypad();
}

function setupKeypad() {
  const labels = ["1","2","3","4","5","6","7","8","9","0"];
  let idx = 0;
  const startX = 320, startY = 240;
  const bw = 80, bh = 60, gap = 15;

  keypadButtons = [];
  for (let r = 0; r < 4; r++) {
    for (let c = 0; c < 3; c++) {
      if (r === 3 && c > 0) break;
      keypadButtons.push({
        label: labels[idx++],
        x: startX + c * (bw + gap),
        y: startY + r * (bh + gap),
        w: bw, h: bh
      });
    }
  }

  clearBtn = { label: "Clear", x: 320, y: startY + 4*(bh+gap), w: bw, h: bh };
  enterBtn = { label: "Enter", x: 320 + bw + gap, y: clearBtn.y, w: bw*2 + gap, h: bh };
}


// --------------------------------------------------
// DRAW LOOP
// --------------------------------------------------

function draw() {
  background(238);

  drawHeader();

  if (state === "overview")   drawOverview();
  if (state === "aisle")      drawAisle();
  if (state === "cashier")    drawCashier();
  if (state === "pin")        drawPin();
  if (state === "success")    drawSuccess();
}

function drawHeader() {
  fill(30);
  noStroke();
  rect(0,0,width,70);
  fill(255);
  textSize(22);
  textAlign(LEFT, CENTER);
  text("Supermarket Experience", 24, 35);
}


// --------------------------------------------------
// SCREEN 1 — OVERVIEW
// --------------------------------------------------

function drawOverview() {
  image(IMG.supermarket, 0, 70, width, 340);

  fill(30);
  textSize(18);
  text("Go to Aisle 2 and select the Cereal Box.", 24, 430);

  textAlign(CENTER, CENTER);
  textSize(16);

  aisleButtons.forEach(btn => {
    const hover = isHover(btn);
    fill(hover ? 235 : 250);
    noStroke();
    rect(btn.x, btn.y, btn.w, btn.h, 12);
    fill(40);
    text(btn.label, btn.x + btn.w/2, btn.y + btn.h/2);
  });
}


// --------------------------------------------------
// SCREEN 2 — AISLE
// --------------------------------------------------

function drawAisle() {
  image(IMG.aisle2, 0, 70, width, 360);

  drawBackButton();

  fill(30);
  textSize(18);
  text("Click on the Cereal Box.", 24, 450);

  const hover = isHover(cerealBoxRect);

  stroke(hover ? 255 : 230);
  strokeWeight(3);
  fill(255);
  rect(cerealBoxRect.x, cerealBoxRect.y, cerealBoxRect.w, cerealBoxRect.h, 16);

  noStroke();
  image(
    IMG.cereal,
    cerealBoxRect.x + 10,
    cerealBoxRect.y + 10,
    cerealBoxRect.w - 20,
    cerealBoxRect.h - 60
  );

  fill(40);
  textAlign(CENTER, TOP);
  text("Cereal Box", cerealBoxRect.x + cerealBoxRect.w/2, cerealBoxRect.y + cerealBoxRect.h - 35);
}


// --------------------------------------------------
// SCREEN 3 — CASHIER
// --------------------------------------------------

function drawCashier() {
  image(IMG.cashier, 0, 70, width, 360);

  drawBackButton();

  fill(30);
  textSize(18);
  text("Click the cashier to pay.", 24, 450);

  const hover = isHover(cashierRect);
  noFill();
  stroke(hover ? color(255,230,150) : color(220));
  strokeWeight(3);
  rect(cashierRect.x, cashierRect.y, cashierRect.w, cashierRect.h, 16);
}


// --------------------------------------------------
// SCREEN 4 — PIN ENTRY
// --------------------------------------------------

function drawPin() {
  fill(245);
  rect(260, 130, 380, 60, 10);

  fill(40);
  textSize(18);
  textAlign(LEFT, CENTER);
  text("Enter PIN:", 280, 160);

  const masked = "•".repeat(pinInput.length);
  textAlign(RIGHT, CENTER);
  text(masked, 620, 160);

  drawKeypad();
}

function drawKeypad() {
  textAlign(CENTER, CENTER);
  textSize(18);

  keypadButtons.forEach(btn => {
    const hover = isHover(btn);
    stroke(hover ? 80 : 180);
    fill(hover ? 240 : 252);
    strokeWeight(1);
    rect(btn.x, btn.y, btn.w, btn.h, 10);
    noStroke();
    fill(40);
    text(btn.label, btn.x + btn.w/2, btn.y + btn.h/2);
  });

  // Clear
  const hc = isHover(clearBtn);
  stroke(hc ? 80 : 180);
  fill(hc ? 240 : 252);
  rect(clearBtn.x, clearBtn.y, clearBtn.w, clearBtn.h, 10);
  noStroke();
  fill(40);
  text("Clear", clearBtn.x + clearBtn.w/2, clearBtn.y + clearBtn.h/2);

  // Enter
  const he = isHover(enterBtn);
  stroke(he ? 80 : 180);
  fill(he ? 235 : 248);
  rect(enterBtn.x, enterBtn.y, enterBtn.w, enterBtn.h, 10);
  noStroke();
  fill(40);
  text("Enter", enterBtn.x + enterBtn.w/2, enterBtn.y + enterBtn.h/2);

  fill(60);
  textSize(14);
  text("Enter PIN 1289 and press Enter.", width/2, 520);
}


// --------------------------------------------------
// SUCCESS SCREEN
// --------------------------------------------------

function drawSuccess() {
  fill(255);
  rect(170, 160, width-340, 260, 20);

  fill(40,130,80);
  textAlign(CENTER, CENTER);
  textSize(28);
  text("Payment Accepted", width/2, 220);

  fill(50);
  textSize(18);
  text(
    "You have completed the task.\n\nClick “Next” below to continue.",
    width/2,
    300
  );
}


// --------------------------------------------------
// INTERACTION
// --------------------------------------------------

function isHover(r) {
  return mouseX >= r.x && mouseX <= r.x+r.w &&
         mouseY >= r.y && mouseY <= r.y+r.h;
}

function drawBackButton() {
  const hover = isHover(backButton);
  fill(hover ? 220 : 240);
  noStroke();
  rect(backButton.x, backButton.y, backButton.w, backButton.h, 10);
  fill(40);
  textAlign(CENTER, CENTER);
  text("Back", backButton.x + backButton.w/2, backButton.y + backButton.h/2);
}

function mousePressed() {
  // OVERVIEW
  if (state === "overview") {
    aisleButtons.forEach(btn => {
      if (isHover(btn) && btn.id === 2) {
        state = "aisle";
      }
    });
    return;
  }

  // AISLE
  if (state === "aisle") {
    if (isHover(backButton)) {
      state = "overview"; return;
    }
    if (isHover(cerealBoxRect)) {
      state = "cashier"; return;
    }
  }

  // CASHIER
  if (state === "cashier") {
    if (isHover(backButton)) {
      state = "aisle"; return;
    }
    if (isHover(cashierRect)) {
      state = "pin"; return;
    }
  }

  // PIN
  if (state === "pin") {
    // digits
    for (let b of keypadButtons) {
      if (isHover(b)) {
        if (pinInput.length < 6) pinInput += b.label;
        return;
      }
    }
    // clear
    if (isHover(clearBtn)) { pinInput = ""; return; }
    // enter
    if (isHover(enterBtn)) {
      if (pinInput === PIN) state = "success";
      else pinInput = "";
      return;
    }
  }
}

</script>
</body>
</html>
